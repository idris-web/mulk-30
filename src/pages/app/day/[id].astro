---
import Layout from '../../../layouts/Layout.astro';
import { MULK_VERSES, SURAH_INFO, getVerseByDay } from '../../../data/mulk-verses';

export function getStaticPaths() {
  return MULK_VERSES.map((v) => ({ params: { id: String(v.dayIndex) } }));
}

const { id } = Astro.params;
const dayIndex = parseInt(id);
const verse = getVerseByDay(dayIndex)!;
const prevDay = dayIndex > 1 ? dayIndex - 1 : null;
const nextDay = dayIndex < 30 ? dayIndex + 1 : null;
---

<Layout title={`Dita ${dayIndex}`}>
  <div class="min-h-screen flex flex-col bg-[var(--color-background)]">
    <!-- Header -->
    <header class="sticky top-0 z-10 bg-[var(--color-surface)]/80 backdrop-blur-lg border-b border-[var(--color-border)] px-4 py-3 safe-top">
      <div class="max-w-lg mx-auto flex items-center justify-between">
        <a href="/app" class="w-10 h-10 rounded-full bg-[var(--color-background)] flex items-center justify-center">
          <svg class="w-5 h-5 text-[var(--color-text)]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
        </a>
        <div class="text-center">
          <h1 class="text-lg font-semibold text-[var(--color-text)]">Dita {dayIndex}</h1>
          <p class="text-xs text-[var(--color-text-secondary)]">Ajeti {verse.ayahNumber} • {SURAH_INFO.name}</p>
        </div>
        <button id="mark-done" class="w-10 h-10 rounded-full flex items-center justify-center border-2 border-[var(--color-border)]" data-day={dayIndex} aria-label="Shëno si të përfunduar">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
        </button>
      </div>
    </header>

    <main class="flex-1 px-4 py-8">
      <div class="max-w-lg mx-auto space-y-8">
        
        <!-- Day badge -->
        <div class="text-center">
          <div class="inline-flex items-center gap-2 bg-[var(--color-primary)]/10 text-[var(--color-primary)] px-4 py-2 rounded-full text-sm font-medium" id="day-badge">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
            Dita {dayIndex} nga 30
          </div>
        </div>

        <!-- Arabic Verse -->
        <div class="bg-[var(--color-surface)] rounded-2xl p-6 border border-[var(--color-border)]">
          <p class="arabic arabic-xl text-center text-[var(--color-text)] leading-loose">
            {verse.arabic}
          </p>
        </div>

        <!-- Transliteration -->
        <div class="text-center">
          <p class="text-[var(--color-text-secondary)] italic leading-relaxed">
            {verse.transliteration}
          </p>
        </div>

        <!-- Divider -->
        <div class="flex items-center gap-4">
          <div class="flex-1 h-px bg-[var(--color-border)]"></div>
          <span class="text-xs text-[var(--color-text-secondary)] uppercase tracking-wider">Përkthimi</span>
          <div class="flex-1 h-px bg-[var(--color-border)]"></div>
        </div>

        <!-- Albanian Translation -->
        <div class="bg-[var(--color-surface)] rounded-2xl p-6 border border-[var(--color-border)]">
          <p class="text-[var(--color-text)] text-lg leading-relaxed">
            {verse.albanian}
          </p>
        </div>

        <!-- Mark Complete -->
        <button id="complete-btn" class="btn btn-primary w-full py-4 text-lg" data-day={dayIndex}>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
          <span id="complete-label">Shëno si të përfunduar</span>
        </button>

        <!-- Navigation -->
        <div class="flex gap-3">
          {prevDay ? (
            <a href={`/app/day/${prevDay}`} class="btn btn-secondary flex-1">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
              Dita {prevDay}
            </a>
          ) : <div class="flex-1"></div>}
          {nextDay ? (
            <a href={`/app/day/${nextDay}`} class="btn btn-secondary flex-1 justify-end">
              Dita {nextDay}
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
            </a>
          ) : <div class="flex-1"></div>}
        </div>
      </div>
    </main>
  </div>
</Layout>

<script>
  import { toggleDay, isDayCompleted } from '../../../lib/challenge';

  const dayIndex = parseInt(document.getElementById('complete-btn')?.getAttribute('data-day') || '1');

  function updateUI() {
    const completed = isDayCompleted(dayIndex);
    const btn = document.getElementById('complete-btn') as HTMLButtonElement;
    const label = document.getElementById('complete-label')!;
    const headerBtn = document.getElementById('mark-done') as HTMLButtonElement;

    if (completed) {
      btn.classList.remove('btn-primary');
      btn.classList.add('!bg-[var(--color-success)]');
      label.textContent = 'E përfunduar';
      headerBtn.classList.add('bg-[var(--color-primary)]', 'text-white', 'border-[var(--color-primary)]');
    } else {
      btn.classList.add('btn-primary');
      btn.classList.remove('!bg-[var(--color-success)]');
      label.textContent = 'Shëno si të përfunduar';
      headerBtn.classList.remove('bg-[var(--color-primary)]', 'text-white', 'border-[var(--color-primary)]');
    }
  }

  document.getElementById('complete-btn')?.addEventListener('click', () => {
    toggleDay(dayIndex);
    updateUI();
  });

  document.getElementById('mark-done')?.addEventListener('click', () => {
    toggleDay(dayIndex);
    updateUI();
  });

  updateUI();
</script>
